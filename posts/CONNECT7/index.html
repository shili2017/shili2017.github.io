<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="CONNECT Note (7) - So… why Chisel?" /><meta property="og:locale" content="en" /><meta name="description" content="We define our AXI4 protocol interface as follows." /><meta property="og:description" content="We define our AXI4 protocol interface as follows." /><link rel="canonical" href="https://shili2017.github.io/posts/CONNECT7/" /><meta property="og:url" content="https://shili2017.github.io/posts/CONNECT7/" /><meta property="og:site_name" content="Li Shi" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-07-12T07:43:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="CONNECT Note (7) - So… why Chisel?" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-07-12T07:43:00+00:00","datePublished":"2022-07-12T07:43:00+00:00","description":"We define our AXI4 protocol interface as follows.","headline":"CONNECT Note (7) - So… why Chisel?","mainEntityOfPage":{"@type":"WebPage","@id":"https://shili2017.github.io/posts/CONNECT7/"},"url":"https://shili2017.github.io/posts/CONNECT7/"}</script><title>CONNECT Note (7) - So... why Chisel? | Li Shi</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Li Shi"><meta name="application-name" content="Li Shi"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/avatar/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">Li Shi</a></div><div class="site-subtitle font-italic">Sleep every day</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/shili2017" aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> </a> <a href="https://www.linkedin.com/in/lishi2022" aria-label="linkedin" target="_blank" rel="noopener noreferrer"> <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['shili2048','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>CONNECT Note (7) - So... why Chisel?</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>CONNECT Note (7) - So... why Chisel?</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1657611780" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jul 12, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/shili2017">Li Shi</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="518 words"> <em>2 min</em> read</span></div></div></div><div class="post-content"><p>We define our AXI4 protocol interface as follows.</p><div class="language-scala highlighter-rouge"><div class="code-header"> <span data-label-text="Scala"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="k">trait</span> <span class="nc">AXI4Id</span> <span class="k">extends</span> <span class="nc">Bundle</span> <span class="k">with</span> <span class="nc">AXI4Parameters</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">id</span> <span class="k">=</span> <span class="nc">UInt</span><span class="o">(</span><span class="nv">AXI4IdWidth</span><span class="o">.</span><span class="py">W</span><span class="o">)</span>
<span class="o">}</span>

<span class="k">class</span> <span class="nc">AXI4LiteChannelA</span> <span class="k">extends</span> <span class="nc">Bundle</span> <span class="k">with</span> <span class="nc">AXI4Parameters</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">addr</span> <span class="k">=</span> <span class="nc">UInt</span><span class="o">(</span><span class="nv">AXI4AddrWidth</span><span class="o">.</span><span class="py">W</span><span class="o">)</span>
  <span class="k">val</span> <span class="nv">prot</span> <span class="k">=</span> <span class="nc">UInt</span><span class="o">(</span><span class="mf">3.</span><span class="n">W</span><span class="o">)</span>
<span class="o">}</span>

<span class="k">class</span> <span class="nc">AXI4ChannelA</span> <span class="k">extends</span> <span class="nc">AXI4LiteChannelA</span> <span class="k">with</span> <span class="nc">AXI4Id</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">len</span>    <span class="k">=</span> <span class="nc">UInt</span><span class="o">(</span><span class="mf">8.</span><span class="n">W</span><span class="o">)</span>
  <span class="k">val</span> <span class="nv">size</span>   <span class="k">=</span> <span class="nc">UInt</span><span class="o">(</span><span class="mf">3.</span><span class="n">W</span><span class="o">)</span>
  <span class="k">val</span> <span class="nv">burst</span>  <span class="k">=</span> <span class="nc">UInt</span><span class="o">(</span><span class="mf">2.</span><span class="n">W</span><span class="o">)</span>
  <span class="k">val</span> <span class="nv">lock</span>   <span class="k">=</span> <span class="nc">Bool</span><span class="o">()</span>
  <span class="k">val</span> <span class="nv">cache</span>  <span class="k">=</span> <span class="nc">UInt</span><span class="o">(</span><span class="mf">4.</span><span class="n">W</span><span class="o">)</span>
  <span class="k">val</span> <span class="nv">qos</span>    <span class="k">=</span> <span class="nc">UInt</span><span class="o">(</span><span class="mf">4.</span><span class="n">W</span><span class="o">)</span>
  <span class="k">val</span> <span class="nv">region</span> <span class="k">=</span> <span class="nc">UInt</span><span class="o">(</span><span class="mf">4.</span><span class="n">W</span><span class="o">)</span>
<span class="o">}</span>

<span class="c1">// ...</span>

<span class="k">class</span> <span class="nc">AXI4LiteIO</span> <span class="k">extends</span> <span class="nc">Bundle</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">aw</span> <span class="k">=</span> <span class="nc">Decoupled</span><span class="o">(</span><span class="k">new</span> <span class="nc">AXI4LiteChannelA</span><span class="o">)</span>
  <span class="k">val</span> <span class="nv">w</span>  <span class="k">=</span> <span class="nc">Decoupled</span><span class="o">(</span><span class="k">new</span> <span class="nc">AXI4LiteChannelW</span><span class="o">)</span>
  <span class="k">val</span> <span class="nv">b</span>  <span class="k">=</span> <span class="nc">Flipped</span><span class="o">(</span><span class="nc">Decoupled</span><span class="o">(</span><span class="k">new</span> <span class="nc">AXI4LiteChannelB</span><span class="o">))</span>
  <span class="k">val</span> <span class="nv">ar</span> <span class="k">=</span> <span class="nc">Decoupled</span><span class="o">(</span><span class="k">new</span> <span class="nc">AXI4LiteChannelA</span><span class="o">)</span>
  <span class="k">val</span> <span class="nv">r</span>  <span class="k">=</span> <span class="nc">Flipped</span><span class="o">(</span><span class="nc">Decoupled</span><span class="o">(</span><span class="k">new</span> <span class="nc">AXI4LiteChannelR</span><span class="o">))</span>
<span class="o">}</span>

<span class="k">class</span> <span class="nc">AXI4IO</span> <span class="k">extends</span> <span class="nc">AXI4LiteIO</span> <span class="o">{</span>
  <span class="k">override</span> <span class="k">val</span> <span class="nv">aw</span> <span class="k">=</span> <span class="nc">Decoupled</span><span class="o">(</span><span class="k">new</span> <span class="nc">AXI4ChannelA</span><span class="o">)</span>
  <span class="k">override</span> <span class="k">val</span> <span class="nv">w</span>  <span class="k">=</span> <span class="nc">Decoupled</span><span class="o">(</span><span class="k">new</span> <span class="nc">AXI4ChannelW</span><span class="o">)</span>
  <span class="k">override</span> <span class="k">val</span> <span class="nv">b</span>  <span class="k">=</span> <span class="nc">Flipped</span><span class="o">(</span><span class="nc">Decoupled</span><span class="o">(</span><span class="k">new</span> <span class="nc">AXI4ChannelB</span><span class="o">))</span>
  <span class="k">override</span> <span class="k">val</span> <span class="nv">ar</span> <span class="k">=</span> <span class="nc">Decoupled</span><span class="o">(</span><span class="k">new</span> <span class="nc">AXI4ChannelA</span><span class="o">)</span>
  <span class="k">override</span> <span class="k">val</span> <span class="nv">r</span>  <span class="k">=</span> <span class="nc">Flipped</span><span class="o">(</span><span class="nc">Decoupled</span><span class="o">(</span><span class="k">new</span> <span class="nc">AXI4ChannelR</span><span class="o">))</span>
<span class="o">}</span>
</pre></table></code></div></div><p>OOP features including templates, inheritance and polymorphism make things much easier for RTL programmers. For example, in terms of AXI4 bridge design, almost every line of code can be reused for AXI4-Lite protocol. The following code snippet shows one of the FSMs in the bridge.</p><div class="language-scala highlighter-rouge"><div class="code-header"> <span data-label-text="Scala"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="c1">// FSM to handle AXI master device read</span>
<span class="nf">switch</span><span class="o">(</span><span class="n">r_state</span><span class="o">)</span> <span class="o">{</span>
  <span class="nf">is</span><span class="o">(</span><span class="n">r_addr</span><span class="o">)</span> <span class="o">{</span>
    <span class="nf">when</span><span class="o">(</span><span class="nv">io</span><span class="o">.</span><span class="py">axi</span><span class="o">.</span><span class="py">ar</span><span class="o">.</span><span class="py">fire</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">r_state</span> <span class="o">:=</span> <span class="n">r_data</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="nf">is</span><span class="o">(</span><span class="n">r_data</span><span class="o">)</span> <span class="o">{</span>
    <span class="nf">if</span> <span class="o">(</span><span class="nv">io</span><span class="o">.</span><span class="py">axi</span><span class="o">.</span><span class="py">r</span><span class="o">.</span><span class="py">bits</span><span class="o">.</span><span class="py">getClass</span> <span class="o">==</span> <span class="n">classOf</span><span class="o">[</span><span class="kt">AXI4ChannelR</span><span class="o">])</span> <span class="o">{</span>
      <span class="nf">when</span><span class="o">(</span><span class="nv">io</span><span class="o">.</span><span class="py">axi</span><span class="o">.</span><span class="py">r</span><span class="o">.</span><span class="py">fire</span> <span class="o">&amp;&amp;</span> <span class="nv">io</span><span class="o">.</span><span class="py">axi</span><span class="o">.</span><span class="py">r</span><span class="o">.</span><span class="py">bits</span><span class="o">.</span><span class="py">asInstanceOf</span><span class="o">[</span><span class="kt">AXI4ChannelR</span><span class="o">].</span><span class="py">last</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">r_state</span> <span class="o">:=</span> <span class="n">r_addr</span>
      <span class="o">}</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="nf">when</span><span class="o">(</span><span class="nv">io</span><span class="o">.</span><span class="py">axi</span><span class="o">.</span><span class="py">r</span><span class="o">.</span><span class="py">fire</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">r_state</span> <span class="o">:=</span> <span class="n">r_addr</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>We also need to redefine the method to pack and unpack the data as follows.</p><div class="language-scala highlighter-rouge"><div class="code-header"> <span data-label-text="Scala"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="c1">// Pack the data in aw/ar channel</span>
<span class="k">object</span> <span class="nc">AXI4ChannelA2PacketData</span> <span class="o">{</span>
  <span class="k">def</span> <span class="nf">apply</span><span class="o">[</span><span class="kt">C</span> <span class="k">&lt;:</span> <span class="kt">AXI4LiteChannelA</span><span class="o">](</span><span class="n">a</span><span class="k">:</span> <span class="kt">C</span><span class="o">,</span> <span class="n">is_w</span><span class="k">:</span> <span class="kt">Bool</span><span class="o">)</span><span class="k">:</span> <span class="kt">UInt</span> <span class="o">=</span> <span class="o">{</span>
    <span class="nf">if</span> <span class="o">(</span><span class="nv">a</span><span class="o">.</span><span class="py">getClass</span> <span class="o">==</span> <span class="n">classOf</span><span class="o">[</span><span class="kt">AXI4ChannelA</span><span class="o">])</span> <span class="o">{</span>
      <span class="k">val</span> <span class="nv">a_</span> <span class="k">=</span> <span class="nv">a</span><span class="o">.</span><span class="py">asInstanceOf</span><span class="o">[</span><span class="kt">AXI4ChannelA</span><span class="o">]</span>
      <span class="nc">Cat</span><span class="o">(</span>
        <span class="nv">a_</span><span class="o">.</span><span class="py">id</span><span class="o">,</span>
        <span class="nv">a_</span><span class="o">.</span><span class="py">addr</span><span class="o">,</span>
        <span class="nv">a_</span><span class="o">.</span><span class="py">region</span><span class="o">,</span>
        <span class="nv">a_</span><span class="o">.</span><span class="py">qos</span><span class="o">,</span>
        <span class="nv">a_</span><span class="o">.</span><span class="py">prot</span><span class="o">,</span>
        <span class="nv">a_</span><span class="o">.</span><span class="py">cache</span><span class="o">,</span>
        <span class="nv">a_</span><span class="o">.</span><span class="py">lock</span><span class="o">.</span><span class="py">asUInt</span><span class="o">,</span>
        <span class="nv">a_</span><span class="o">.</span><span class="py">burst</span><span class="o">,</span>
        <span class="nv">a_</span><span class="o">.</span><span class="py">size</span><span class="o">,</span>
        <span class="nv">a_</span><span class="o">.</span><span class="py">len</span><span class="o">,</span>
        <span class="nc">Mux</span><span class="o">(</span><span class="n">is_w</span><span class="o">,</span> <span class="nv">AXI4ChannelID</span><span class="o">.</span><span class="py">AW</span><span class="o">,</span> <span class="nv">AXI4ChannelID</span><span class="o">.</span><span class="py">AR</span><span class="o">)</span>
      <span class="o">)</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="nc">Cat</span><span class="o">(</span>
        <span class="nv">a</span><span class="o">.</span><span class="py">addr</span><span class="o">,</span>
        <span class="nv">a</span><span class="o">.</span><span class="py">prot</span><span class="o">,</span>
        <span class="nc">Mux</span><span class="o">(</span><span class="n">is_w</span><span class="o">,</span> <span class="nv">AXI4ChannelID</span><span class="o">.</span><span class="py">AW</span><span class="o">,</span> <span class="nv">AXI4ChannelID</span><span class="o">.</span><span class="py">AR</span><span class="o">)</span>
      <span class="o">)</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-scala highlighter-rouge"><div class="code-header"> <span data-label-text="Scala"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="c1">// Unpack the data in aw/ar channel</span>
<span class="k">object</span> <span class="nc">Packet2AXI4ChannelA</span> <span class="o">{</span>
  <span class="k">def</span> <span class="nf">apply</span><span class="o">[</span><span class="kt">B</span> <span class="k">&lt;:</span> <span class="kt">AXI4LiteIO</span><span class="o">](</span><span class="n">bus_io</span><span class="k">:</span> <span class="kt">B</span><span class="o">)(</span><span class="n">packet</span><span class="k">:</span> <span class="kt">UInt</span><span class="o">)</span><span class="k">:</span> <span class="kt">AXI4LiteChannelA</span> <span class="o">=</span> <span class="o">{</span>
    <span class="nf">assert</span><span class="o">(</span><span class="nv">packet</span><span class="o">.</span><span class="py">getWidth</span> <span class="o">==</span> <span class="nc">AXI4PacketWidth</span><span class="o">(</span><span class="n">bus_io</span><span class="o">))</span>
    <span class="nf">if</span> <span class="o">(</span><span class="nv">bus_io</span><span class="o">.</span><span class="py">getClass</span> <span class="o">==</span> <span class="n">classOf</span><span class="o">[</span><span class="kt">AXI4IO</span><span class="o">])</span> <span class="o">{</span>
      <span class="k">val</span> <span class="nv">a</span> <span class="k">=</span> <span class="nc">Wire</span><span class="o">(</span><span class="k">new</span> <span class="nc">AXI4ChannelA</span><span class="o">)</span>
      <span class="nv">a</span><span class="o">.</span><span class="py">id</span> <span class="o">:=</span> <span class="nf">packet</span><span class="o">(</span>
        <span class="mi">31</span> <span class="o">+</span> <span class="nv">AXI4Parameters</span><span class="o">.</span><span class="py">AXI4AddrWidth</span> <span class="o">+</span> <span class="nv">AXI4Parameters</span><span class="o">.</span><span class="py">AXI4IdWidth</span><span class="o">,</span>
        <span class="mi">32</span> <span class="o">+</span> <span class="nv">AXI4Parameters</span><span class="o">.</span><span class="py">AXI4AddrWidth</span>
      <span class="o">)</span>
      <span class="nv">a</span><span class="o">.</span><span class="py">addr</span>   <span class="o">:=</span> <span class="nf">packet</span><span class="o">(</span><span class="mi">31</span> <span class="o">+</span> <span class="nv">AXI4Parameters</span><span class="o">.</span><span class="py">AXI4AddrWidth</span><span class="o">,</span> <span class="mi">32</span><span class="o">)</span>
      <span class="nv">a</span><span class="o">.</span><span class="py">region</span> <span class="o">:=</span> <span class="nf">packet</span><span class="o">(</span><span class="mi">31</span><span class="o">,</span> <span class="mi">28</span><span class="o">)</span>
      <span class="nv">a</span><span class="o">.</span><span class="py">qos</span>    <span class="o">:=</span> <span class="nf">packet</span><span class="o">(</span><span class="mi">27</span><span class="o">,</span> <span class="mi">24</span><span class="o">)</span>
      <span class="nv">a</span><span class="o">.</span><span class="py">prot</span>   <span class="o">:=</span> <span class="nf">packet</span><span class="o">(</span><span class="mi">23</span><span class="o">,</span> <span class="mi">21</span><span class="o">)</span>
      <span class="nv">a</span><span class="o">.</span><span class="py">cache</span>  <span class="o">:=</span> <span class="nf">packet</span><span class="o">(</span><span class="mi">20</span><span class="o">,</span> <span class="mi">17</span><span class="o">)</span>
      <span class="nv">a</span><span class="o">.</span><span class="py">lock</span>   <span class="o">:=</span> <span class="nf">packet</span><span class="o">(</span><span class="mi">16</span><span class="o">).</span><span class="py">asBool</span>
      <span class="nv">a</span><span class="o">.</span><span class="py">burst</span>  <span class="o">:=</span> <span class="nf">packet</span><span class="o">(</span><span class="mi">15</span><span class="o">,</span> <span class="mi">14</span><span class="o">)</span>
      <span class="nv">a</span><span class="o">.</span><span class="py">size</span>   <span class="o">:=</span> <span class="nf">packet</span><span class="o">(</span><span class="mi">13</span><span class="o">,</span> <span class="mi">11</span><span class="o">)</span>
      <span class="nv">a</span><span class="o">.</span><span class="py">len</span>    <span class="o">:=</span> <span class="nf">packet</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="mi">3</span><span class="o">)</span>
      <span class="n">a</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="k">val</span> <span class="nv">a</span> <span class="k">=</span> <span class="nc">Wire</span><span class="o">(</span><span class="k">new</span> <span class="nc">AXI4LiteChannelA</span><span class="o">)</span>
      <span class="nv">a</span><span class="o">.</span><span class="py">addr</span> <span class="o">:=</span> <span class="nf">packet</span><span class="o">(</span><span class="mi">5</span> <span class="o">+</span> <span class="nv">AXI4Parameters</span><span class="o">.</span><span class="py">AXI4AddrWidth</span><span class="o">,</span> <span class="mi">6</span><span class="o">)</span>
      <span class="nv">a</span><span class="o">.</span><span class="py">prot</span> <span class="o">:=</span> <span class="nf">packet</span><span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="mi">3</span><span class="o">)</span>
      <span class="n">a</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/calcm/'>CALCM</a>, <a href='/categories/connect/'>CONNECT</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=CONNECT%20Note%20(7)%20-%20So...%20why%20Chisel?%20-%20Li%20Shi&url=https%3A%2F%2Fshili2017.github.io%2Fposts%2FCONNECT7%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=CONNECT%20Note%20(7)%20-%20So...%20why%20Chisel?%20-%20Li%20Shi&u=https%3A%2F%2Fshili2017.github.io%2Fposts%2FCONNECT7%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fshili2017.github.io%2Fposts%2FCONNECT7%2F&text=CONNECT%20Note%20(7)%20-%20So...%20why%20Chisel?%20-%20Li%20Shi" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fshili2017.github.io%2Fposts%2FCONNECT7%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <a href="http://service.weibo.com/share/share.php?title=CONNECT%20Note%20(7)%20-%20So...%20why%20Chisel?%20-%20Li%20Shi&url=https%3A%2F%2Fshili2017.github.io%2Fposts%2FCONNECT7%2F" data-toggle="tooltip" data-placement="top" title="Weibo" target="_blank" rel="noopener" aria-label="Weibo"> <i class="fa-fw fab fa-weibo"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/BOOKS/">2023年读书记录</a><li><a href="/posts/NOC5/">《片上网络》笔记（五）：流量控制</a><li><a href="/posts/MCCC9/">《内存一致性与缓存一致性》笔记（九）：异构系统的内存一致性与缓存一致性</a><li><a href="/posts/RL4/">CMU 18-643可重构计算笔记-4：类C语言硬件综合的挑战</a><li><a href="/posts/RL1/">CMU 18-643可重构计算笔记-1：FPGA的三个时代</a></ul></div></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/CONNECT1/"><div class="card-body"> <em class="small" data-ts="1653579120" data-df="ll" > May 26, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>CONNECT Note (1) - Paper</h3><div class="text-muted small"><p> 原文：CONNECT: Re-Examining Conventional Wisdom for Designing NoCs in the Context of FPGAs. CONNECT是一个NoC生成器，面向FPGA生成任意多节点拓扑结构的可综合RTL设计，这里有一个online demo。CONNECT的意义在于，传统的NoC设计都为ASIC优化，但是面向FPGA的NoC设计需要...</p></div></div></a></div><div class="card"> <a href="/posts/CONNECT2/"><div class="card-body"> <em class="small" data-ts="1654046820" data-df="ll" > Jun 1, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>CONNECT Note (2) - Setup</h3><div class="text-muted small"><p> Run CONNECT testbench Thank Siddharth for providing the notes! Clone the repository from Crossroads GitHub To build a basic double ring network with 4 ports, 256 bit flits, 2 vi...</p></div></div></a></div><div class="card"> <a href="/posts/CONNECT3/"><div class="card-body"> <em class="small" data-ts="1654139220" data-df="ll" > Jun 2, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>CONNECT Note (3) - AXI4 Interface</h3><div class="text-muted small"><p> Source code: link. AXI Requests &amp;amp; Responses In Flits Signals in 5 channels are encapsulated in flit data, with following parameters. parameter ADDR_WIDTH = 32; parameter DATA_WIDTH = 64;...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/MCCC6/" class="btn btn-outline-primary" prompt="Older"><p>《内存一致性与缓存一致性》笔记（六）：缓存一致性协议</p></a> <a href="/posts/CONNECT-AXI-CHISEL-DOCS/" class="btn btn-outline-primary" prompt="Newer"><p>CONNECT AXI Chisel Wrapper Documentation (Draft)</p></a></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/shili2017">Li Shi</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0">Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script>
